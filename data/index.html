<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Time Tape Control</title>
	<link rel="stylesheet" href="style.css">
</head>

<body>

	<div class="container">
		<div class="tabs">
			<div class="tab active" onclick="setTab(0)">화면 설정</div>
			<div class="tab" onclick="setTab(1)">디데이 관리</div>
			<div class="tab" onclick="setTab(2)">밝기/야간</div>
			<div class="tab" onclick="setTab(3)">로그</div>
		</div>

		<div class="content active" id="tab0">
			<div class="preset-tabs" id="presetTabs"></div>

			<div id="presetEditor">

				<div class="section">

					<div class="sec-title" style="border-bottom: 0px; margin-bottom: 0px;">

						<span>프리셋 순서 조정</span>

						<div style="display:flex; gap:5px;">

							<button onclick="movePreset(-1)"
								style="width:auto; padding:5px 10px; margin:0; background:#444;">◀</button>

							<button onclick="movePreset(1)"
								style="width:auto; padding:5px 10px; margin:0; background:#444;">▶</button>

							<button class="btn-red" onclick="delPreset()"
								style="width:auto; padding:5px 10px; margin:0;">삭제</button>

						</div>



					</div>

				</div>


				<div class="section">
					<div class="sec-title">안쪽 링 (Inner Ring)</div>
					<label>표시 정보</label>
					<select id="im" onchange="updatePresetData('im')">
						<option value="0">올해 진행률</option>
						<option value="5">이번 분기 진행률</option>
						<option value="1">이번 달 진행률</option>
						<option value="2">이번 주 진행률</option>
						<option value="3">오늘 진행률</option>
						<option value="4">커스텀 디데이</option>
                        <option value="10">카운터 (Counter)</option>
                        <option value="11">타이머 (Timer)</option>
                        <option value="12">뽀모도로 (Pomodoro)</option>
					</select>
					<div id="im_dd_box" style="display:none; margin-bottom:10px;">
						<select id="id_dd" onchange="updatePresetData()"></select>
					</div>

					<label>색상 모드</label>
					<select id="icm" onchange="updatePresetData()">
						<option value="0">단색 (Solid)</option>
						<option value="1">무지개 (Rainbow)</option>
						<option value="2">진행 그라데이션 (Time Gradient)</option>
						<option value="3">고정 그라데이션 (Space Gradient)</option>
					</select>

					<div class="color-row">
						<div class="color-box" id="icf_box"><input type="color" id="icf"
								onchange="updatePresetData()"><span id="icf_label">채움 색</span></div>
						<div class="color-box" id="icf2_box" style="display:none;"><input type="color" id="icf2"
								onchange="updatePresetData()"><span>끝 색상</span></div>
						<div class="color-box"><input type="color" id="ice" onchange="updatePresetData()"><span>빈
								곳</span></div>
					</div>
                    
					<div id="im_sv_box" style="display:none; margin-top:10px;">
                        <label id="im_sv_label">설정값</label>
                        <input type="number" id="im_sv" onchange="updatePresetData()">
                        <div id="im_sv2_container" style="display:none; margin-top:5px;">
                            <label>휴식 시간 (분)</label>
                            <input type="number" id="im_sv2" onchange="updatePresetData()">
                        </div>
						<div id="im_sec_container" style="display:none; margin-top:8px;" class="inline-check-row">
							<div class="unit-switch" role="group" aria-label="안쪽 링 시간 단위">
								<input type="radio" name="im_unit" id="im_unit_min" value="min" onchange="updatePresetData()" checked>
								<label for="im_unit_min">분</label>
								<input type="radio" name="im_unit" id="im_unit_sec" value="sec" onchange="updatePresetData()">
								<label for="im_unit_sec">초</label>
							</div>
						</div>
                    </div>
				</div>

				<div class="section">
					<div class="sec-title">바깥쪽 링 (Outer Ring)</div>
					<label>표시 정보</label>
					<select id="om" onchange="updatePresetData('om')">
						<option value="0">올해 진행률</option>
						<option value="5">이번 분기 진행률</option>
						<option value="1">이번 달 진행률</option>
						<option value="2">이번 주 진행률</option>
						<option value="3">오늘 진행률</option>
						<option value="4">커스텀 디데이</option>
                        <option value="10">카운터 (Counter)</option>
                        <option value="11">타이머 (Timer)</option>
                        <option value="12">뽀모도로 (Pomodoro)</option>
					</select>
					<div id="om_dd_box" style="display:none; margin-bottom:10px;">
						<select id="od" onchange="updatePresetData()"></select>
					</div>

					<label>색상 모드</label>
					<select id="ocm" onchange="updatePresetData()">
						<option value="0">단색 (Solid)</option>
						<option value="1">무지개 (Rainbow)</option>
						<option value="2">진행 그라데이션 (Time Gradient)</option>
						<option value="3">고정 그라데이션 (Space Gradient)</option>
					</select>

					<div class="color-row">
						<div class="color-box" id="ocf_box"><input type="color" id="ocf"
								onchange="updatePresetData()"><span id="ocf_label">채움 색</span></div>
						<div class="color-box" id="ocf2_box" style="display:none;"><input type="color" id="ocf2"
								onchange="updatePresetData()"><span>끝 색상</span></div>
						<div class="color-box"><input type="color" id="oce" onchange="updatePresetData()"><span>빈
								곳</span></div>
					</div>
                    
					<div id="om_sv_box" style="display:none; margin-top:10px;">
                        <label id="om_sv_label">설정값</label>
                        <input type="number" id="om_sv" onchange="updatePresetData()">
                        <div id="om_sv2_container" style="display:none; margin-top:5px;">
                            <label>휴식 시간 (분)</label>
                            <input type="number" id="om_sv2" onchange="updatePresetData()">
                        </div>
						<div id="om_sec_container" style="display:none; margin-top:8px;" class="inline-check-row">
							<div class="unit-switch" role="group" aria-label="바깥쪽 링 시간 단위">
								<input type="radio" name="om_unit" id="om_unit_min" value="min" onchange="updatePresetData()" checked>
								<label for="om_unit_min">분</label>
								<input type="radio" name="om_unit" id="om_unit_sec" value="sec" onchange="updatePresetData()">
								<label for="om_unit_sec">초</label>
							</div>
						</div>
                    </div>
				</div>

				<div class="section">
					<div class="sec-title">7-세그먼트 표시</div>
					<select id="sm" onchange="updatePresetData()">
                        <option value="0">자동 (인터랙티브 우선)</option>
						<option value="1">올해 남은 날</option>
						<option value="6">이번 분기 남은 날</option>
						<option value="2">이번 달 남은 날</option>
						<option value="3">이번 주 남은 날</option>
						<option value="4">오늘 남은 시간</option>
						<option value="5">커스텀 디데이</option>
                        <option value="10">카운터 값</option>
                        <option value="11">타이머 남은 시간</option>
                        <option value="12">뽀모도로 상태</option>
					</select>
					<div id="sm_dd_box" style="display:none; margin-top:5px;">
						<select id="sd" onchange="updatePresetData()"></select>
					</div>
				</div>
                
			</div>
		</div>

		<div class="content" id="tab1">
			<div class="section">
				<div class="sec-title">저장된 디데이 목록</div>
				<div id="ddayListContainer"></div>
				<button class="btn-small" onclick="addDDay()" style="width:100%; margin-top:10px; background:#444;">+ 새
					디데이 추가</button>
			</div>
			<div class="section" id="ddayEditor" style="display:none; border-color:#00e676;">
				<div class="sec-title">디데이 수정</div>
				<label>이름</label><input type="text" id="dName">
				<label>시작일</label><input type="date" id="dStart">
				<label>목표일</label><input type="date" id="dTarget">
				<div class="row" style="margin-top:15px; display:flex; gap:10px;">
					<button class="btn-small" onclick="saveDDay()" style="background:#00c853; color:white;">저장</button>
					<button class="btn-small btn-red" onclick="delDDay()">삭제</button>
				</div>
			</div>
		</div>

		<div class="content" id="tab2">
			<div class="section">
				<div class="sec-title">기본 밝기 <span id="briVal" class="range-val">50</span></div>
				<input type="range" id="bri" min="5" max="150" step="5"
					oninput="document.getElementById('briVal').innerText=this.value">
			</div>
			<div class="section">
				<div class="switch-wrap">
					<span style="font-weight:bold; font-size:14px; color:#ddd;">야간 모드 (자동 밝기)</span>
					<label class="switch">
						<input type="checkbox" id="nEn" onchange="toggleNightBox()">
						<span class="slider"></span>
					</label>
				</div>
				<div id="nightBox" style="display:none;">
					<div class="row" style="display:flex; gap:10px;">
						<div style="flex:1;"><label>시작 시간</label><input type="number" id="nS" min="0" max="23"></div>
						<div style="flex:1;"><label>종료 시간</label><input type="number" id="nE" min="0" max="23"></div>
					</div>
					<label style="margin-top:15px;">야간 밝기 <span id="nBVal" class="range-val">10</span></label>
					<input type="range" id="nB" min="0" max="150" step="5"
						oninput="document.getElementById('nBVal').innerText=this.value">
				</div>
			</div>
		</div>

		<div class="content" id="tab3">
			<div class="section">
				<div class="sec-title">시스템 로그</div>
				<div id="logContainer"></div>
				<button class="btn-small" onclick="clearLog()"
					style="width:auto; margin-top:10px; background:#444; padding: 5px 10px;">지우기</button>
			</div>
			<div class="section">
				<div class="sec-title">Firmware Update (.bin)</div>
				<div id="fwInfoText" class="fw-info">Loading device info...</div>
				<label class="fw-file-label" for="fsFile">Filesystem image (LittleFS, optional)</label>
				<input type="file" id="fsFile" accept=".bin">
				<label class="fw-file-label" for="fwFile">Firmware image (required)</label>
				<input type="file" id="fwFile" accept=".bin">
				<button id="fwUploadBtn" class="btn-small btn-fw" onclick="uploadFirmwareBin()">Upload & Update</button>
				<div class="fw-progress-wrap" aria-live="polite">
					<div class="fw-progress-track">
						<div id="fwProgressFill" class="fw-progress-fill"></div>
					</div>
					<div id="fwProgressText" class="fw-progress-text">0%</div>
				</div>
				<div id="fwUploadStatus" class="fw-status">Select firmware .bin (and optional filesystem .bin), then start update.</div>
				<div class="fw-note">If filesystem is selected, it uploads first, then firmware. Do not power off during update.</div>
			</div>
		</div>

		<button id="saveBtn" class="btn-green" onclick="uploadConfig()">
			<span class="loader" id="saveLoader"></span>
			<span id="saveText">설정 저장하기</span>
		</button>
	</div>
	<script src="script.js"></script>
</body>

</html>
